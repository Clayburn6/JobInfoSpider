<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>职位列表</title>
    <link rel="stylesheet" href="./css/weui.css"/>
    <script src="http://libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>

    <script type="text/javascript">

        $(function () {
            //添加popstate事件
            $(window).on("popstate", query_by_title_company_money);
        });

        var totalPages = 0;
        var number = 1;
        var size = 10;
        function query_by_title_company_money() {
            var title = $("#job_title").val();
            var company = $("#job_company").val();
            var money = $("#job_money").val();

            // 首先获取url
            var curUrl = location.href;
            if (!curUrl.split("?")[1]) { // 如果没有带参数
                // 修改历史记录中当前url，带上默认参数
                history.replaceState(null, "", curUrl + "?title=" + title + "&company=" + company + "&money=" + money
                    + "&pageIndex=" + number + "&pageSize=" + size);
            }
            var params = "?" + location.href.split("?")[1];
                $.ajax({
                    url: "http://penggb.top/query/query" + params,
                    type: "get",
                    dataType: "json",
                    success: function (result) {
                        totalPages = result.totalPages;
                        number = result.number;
                        size = result.size;

                        $("#position_list").each(function () {
                            $(this).remove();
                        })

                        for (var i = 0; i < result.content.length; i++) {
                            var title = result.content[i].title;
                            var money = result.content[i].money;
                            var company = result.content[i].company;
                            var experience = result.content[i].experience;
                            var degree = result.content[i].degree;

                            /*
                            <div class="weui-media-box weui-media-box_text">
                                <h4 class="weui-media-box__title">标题一</h4>
                                <p class="weui-media-box__desc">由各种物质组成的巨型球状天体，叫做星球。星球有一定的形状，有自己的运行轨道。</p>
                                <p class="weui-media-box__desc">由各种物质组成的巨型球状天体，叫做星球。星球有一定的形状，有自己的运行轨道。</p>
                            </div>
                             */

                            var element_div_cell = document.createElement("div"); // 包围每个列表元素的
                            element_div_cell.setAttribute("class", "weui-media-box weui-media-box_text");

                            var element_h4_title = document.createElement("h4"); // 包围列表元素标题
                            element_h4_title.setAttribute("class", "weui-media-box__title");
                            element_h4_title.innerHTML = title;

                            var element_p_req = document.createElement("p"); // 包围岗位要求的
                            element_p_req.setAttribute("class", "weui-media-box__desc")
                            element_p_req.innerHTML = (degree + experience + money);

                            var element_p_company = document.createElement("p") // 包围招聘单位的
                            element_p_req.setAttribute("class", "weui-media-box__desc")
                            element_p_company.innerHTML = company;

                            element_div_cell.appendChild(element_h4_title);
                            element_div_cell.appendChild(element_p_req);
                            element_div_cell.appendChild(element_p_company);

                            $("#position_list").append(element_div_cell);

                        }
                    },
                    error: function (data) {
                        alert("数据加载失败");
                    }
                })
        }
        
        function nextPage() {
            if (number + 1 >= totalPages) {
                number = totalPages - 1;
            } else {
                number = number + 1;
            }
            var title = $("#job_title").val();
            var company = $("#job_company").val();
            var money = $("#job_money").val();
            history.pushState(null, "", location.href.split("?")[0] + "?title=" + title + "&company=" + company
                + "&money=" + money + "&pageIndex=" + number + "&pageSize=" + size);
            query_by_title_company_money()
        }
        function prePage() {
            if (number - 1 < 0) {
                number = 0;
            } else {
                number = number - 1;
            }
            var title = $("#job_title").val();
            var company = $("#job_company").val();
            var money = $("#job_money").val();
            history.pushState(null, "", location.href.split("?")[0] + "?title=" + title + "&company=" + company
                + "&money=" + money + "&pageIndex=" + number + "&pageSize=" + size);
            query_by_title_company_money()
        }
        
        function query() {
            var title = $("#job_title").val();
            var company = $("#job_company").val();
            var money = $("#job_money").val();
            history.pushState(null, "", location.href.split("?")[0] + "?title=" + title + "&company=" + company
                + "&money=" + money + "&pageIndex=" + number + "&pageSize=" + size);
            query_by_title_company_money()
        }

        function jobDetail(id) {
            location.href = "http://penggb.top/detail.html?id=" + id;
        }

        $(function(){
            var $searchBar = $('#searchBar'),
                $searchCance = $('#searchCance'),
                $searchText = $('#searchText'),
                $searchInput = $('#searchInput'),
                $searchClear = $('#searchClear');

            function cancelSearch(){
                $searchBar.removeClass('weui-search-bar_focusing');
                $searchText.show();
            }

            $searchText.on('click', function(){
                $searchBar.addClass('weui-search-bar_focusing');
                $searchInput.focus();
            });
            $searchInput.on('blur', function () {
                if(!this.value.length)
                    cancelSearch();
            });
            $searchClear.on('click', function(){
                $searchInput.focus();
            });

            $searchCance.on('click', function(){
                cancelSearch();
                $searchInput.blur();
            });
        });

    </script>


</head>
<!-- onload="query_by_title_company_money() -->
<body nontouchstart onload="query_by_title_company_money()">
<div class="page">
    <div class="page__bd">
        <div class="weui-search-bar" id="searchBar">
            <form class="weui-search-bar__form">
                <div class="weui-search-bar__box">
                    <i class="weui-icon-search"></i>
                    <input type="search" class="weui-search-bar__input" id="searchInput" placeholder="搜索" required/>
                    <a href="javascript:" class="weui-icon-clear" id="searchClear"></a>
                </div>
                <label class="weui-search-bar__label" id="searchText">
                    <i class="weui-icon-search"></i>
                    <span>职位 薪水 公司</span>
                </label>
            </form>
            <a href="javascript:" class="weui-search-bar__cancel-btn" id="searchCancel">取消</a>
        </div>


        <div class="weui-panel weui-panel_access">
            <div class="weui-panel__bd">
                <div id = "position_list">
                    <div class="weui-media-box weui-media-box_text">
                        <h4 class="weui-media-box__title">标题一</h4>
                        <p class="weui-media-box__desc">由各种物质组成的巨型球状天体，叫做星球。星球有一定的形状，有自己的运行轨道。</p>
                        <p class="weui-media-box__desc">由各种物质组成的巨型球状天体，叫做星球。星球有一定的形状，有自己的运行轨道。</p>
                    </div>
                    <div class="weui-media-box weui-media-box_text">
                        <h4 class="weui-media-box__title">标题二</h4>
                        <p class="weui-media-box__desc">由各种物质组成的巨型球状天体，叫做星球。星球有一定的形状，有自己的运行轨道。</p>
                        <p class="weui-media-box__desc">由各种物质组成的巨型球状天体，叫做星球。星球有一定的形状，有自己的运行轨道。</p>
                    </div>
                </div>

                <div class="weui-panel__ft">
                    <a href="javascript:void(0);" class="weui-cell weui-cell_access weui-cell_link">
                        <div class="weui-cell__bd">查看更多</div>
                        <span class="weui-cell__ft"></span>
                    </a>
                </div>

            </div>
        </div>
    </div>
</div>
</body>
</html>