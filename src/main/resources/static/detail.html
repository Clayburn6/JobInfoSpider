<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>职位详情</title>
    <script src="http://libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
    <script type = "text/javascript">
        var loc = location.href;
        var n1 = loc.length;//地址的总长度
        var n2 = loc.indexOf("=");//取得=号的位置
        var id = loc.substr(n2+1, n1-n2);//从=号后面的内容
        var collectFlag = true;
        $.ajax({
            url: "http://penggb.top/query/detail?id=" + id,
            type: "get",
            dataType: "json",
            success: function (result) {
                var h2 = document.createElement("h2");
                h2.innerHTML = result.title;
                $("#position_detail").append(h2);

                var h5 = document.createElement("h5");
                h5.innerHTML = result.money + result.place + result.experience + result.degree + result.type;
                $("#position_detail").append(h5);

                var h3_advantage = document.createElement("h3");
                h3_advantage.innerHTML = '职位诱惑：';
                $("#position_detail").append(h3_advantage);

                var p_advantage = document.createElement("p");
                p_advantage.innerHTML = result.jobAdvantage;
                $("#position_detail").append(p_advantage);

                var h3_bt = document.createElement("h3");
                h3_bt.innerHTML = '职位描述：';
                $("#position_detail").append(h3_bt);

                var bt = result.jobBt + '';
                var strArray = bt.split(/\s+/g);
                for (var i = 0; i < strArray.length; i++) {
                    var p = document.createElement("p");
                    p.innerHTML = strArray[i];
                    $("#position_detail").append(p);
                }

                var h3_address = document.createElement("h3");
                h3_address.innerHTML = '工作地址：';
                $("#position_detail").append(h3_address);

                var p_address = document.createElement("p");
                p_address.innerHTML = result.jobAddress;
                $('#position_detail').append(p_address);

                $("#job_url").attr("href", result.url);
            },
            error: function (result) {
                console.log("获取职位详情时，ajax请求异常");;
            }
        });

        $.ajax({ // 判断该职位是否已经收藏
            url: "http://penggb.top/checkCollect?jobId=" + id,
            type: "get",
            dataType: "json",
            success: function (result) {
                if (result == true) {
                    collectFlag = true;
                    $("#collect").html("取消收藏");
                } else {
                    collectFlag = false;
                    $("#collect").html("点击收藏");
                }
            }
        });

        function  collect() {
            if (collectFlag) { // 取消收藏
                $.ajax({
                    url: "http://penggb.top/uncollect?jobId=" + id,
                    type: "get",
                    dataType: "json",
                    success: function (result) {
                        collectFlag = false;
                        $("#collect").html("点击收藏");
                    },
                    error: function (result) {
                        console.log("取下收藏时，ajax请求异常");
                    }
                });

            } else { // 添加收藏
                $.ajax({
                    url: "http://penggb.top/collect?jobId=" + id,
                    type: "get",
                    dataType: "json",
                    success: function (result) {
                        collectFlag = true;
                        $("#collect").html("点击收藏");
                    },
                    error: function (result) {
                        console.log("点击收藏时，ajax请求异常");
                    }
                });
            }
        }
    </script>
</head>
<body>
<div id="position_detail">


</div>
<label>原网页地址：</label><a id="job_url" href="">点我访问拉钩网原网页</a>&nbsp;&nbsp;<a id="collect" onclick="collect()"></a><br>
</body>
</html>